<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Upscale Pixel Art ZIP</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<style>
  body { font-family: sans-serif; padding: 2em; background: #222; color: #fff; }
  input, button { margin-top: 1em; display: block; }
</style>
</head>
<body>
<h1>Upscale Pixel Art ZIP</h1>
<input type="file" id="zipInput" accept=".zip"/>
<button id="processBtn">Upscale et créer nouveau ZIP</button>
<script>
document.getElementById('processBtn').addEventListener('click', async () => {
  const fileInput = document.getElementById('zipInput');
  if (!fileInput.files.length) { alert('Choisis un ZIP !'); return; }

  const zipFile = fileInput.files[0];
  const JSZipLib = new JSZip();
  const zip = await JSZipLib.loadAsync(zipFile);

  const newZip = new JSZip();

  for (const filename of Object.keys(zip.files)) {
    const file = zip.files[filename];
    if (!file.dir && /\.(png|jpg|jpeg)$/i.test(filename)) {
      const blob = await file.async('blob');
      const img = await loadImage(blob);
      const upscaledBlob = await upscaleImage(img, 4); // x4, change le facteur si besoin
      newZip.file(filename, upscaledBlob);
    }
  }

  const content = await newZip.generateAsync({ type: "blob" });
  saveAs(content, "sprites_upscaled.zip");
  alert("Nouveau ZIP créé !");
});

// fonction pour charger l'image depuis un blob
function loadImage(blob) {
  return new Promise(resolve => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.src = URL.createObjectURL(blob);
  });
}

// fonction pour upscaler l'image tout en gardant l'effet pixel art
function upscaleImage(img, scale) {
  return new Promise(resolve => {
    const canvas = document.createElement('canvas');
    canvas.width = img.width * scale;
    canvas.height = img.height * scale;
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    canvas.toBlob(blob => resolve(blob), 'image/png');
  });
}
</script>
</body>
</html>